<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Generic helper / demonstration library: decode_helpers.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Generic helper / demonstration library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">decode_helpers.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="decode__helpers_8h_source.html">decode_helpers.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for decode_helpers.c:</div>
<div class="dyncontent">
<div class="center"><img src="decode__helpers_8c__incl.png" border="0" usemap="#adecode__helpers_8c" alt=""/></div>
<map name="adecode__helpers_8c" id="adecode__helpers_8c">
<area shape="rect" title=" " alt="" coords="187,5,337,32"/>
<area shape="rect" title=" " alt="" coords="5,80,84,107"/>
<area shape="rect" title=" " alt="" coords="108,80,195,107"/>
<area shape="rect" title=" " alt="" coords="219,80,305,107"/>
<area shape="rect" title=" " alt="" coords="329,80,416,107"/>
<area shape="rect" href="decode__helpers_8h.html" title=" " alt="" coords="440,80,591,107"/>
<area shape="rect" title=" " alt="" coords="428,155,603,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9df7d5bf99061b8754aad86196f71cde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="decode__helpers_8c.html#a9df7d5bf99061b8754aad86196f71cde">dump_buffer</a> (void *buffer, __u16 size)</td></tr>
<tr class="memdesc:a9df7d5bf99061b8754aad86196f71cde"><td class="mdescLeft">&#160;</td><td class="mdescRight">dump_buffer takes a pointer and dumps a specific number of bytes  <a href="decode__helpers_8c.html#a9df7d5bf99061b8754aad86196f71cde">More...</a><br /></td></tr>
<tr class="separator:a9df7d5bf99061b8754aad86196f71cde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a298daf8160cdf855a5ae27d4fb55b405"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="decode__helpers_8c.html#a298daf8160cdf855a5ae27d4fb55b405">reverse_array_10</a> (__u8 bytes[])</td></tr>
<tr class="memdesc:a298daf8160cdf855a5ae27d4fb55b405"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reverses a 10 byte array.  <a href="decode__helpers_8c.html#a298daf8160cdf855a5ae27d4fb55b405">More...</a><br /></td></tr>
<tr class="separator:a298daf8160cdf855a5ae27d4fb55b405"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a224ae6354763d1d7e15122ecbe5985e0"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structproto__msg.html">proto_msg</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="decode__helpers_8c.html#a224ae6354763d1d7e15122ecbe5985e0">mem_to_msg</a> (const __u8 *ptr)</td></tr>
<tr class="memdesc:a224ae6354763d1d7e15122ecbe5985e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is used to decode protobuf messages and message types.  <a href="decode__helpers_8c.html#a224ae6354763d1d7e15122ecbe5985e0">More...</a><br /></td></tr>
<tr class="separator:a224ae6354763d1d7e15122ecbe5985e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3edfbd2b78d141f355c240b7b1f52e18"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structbgp__ipv4__prefix.html">bgp_ipv4_prefix</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="decode__helpers_8c.html#a3edfbd2b78d141f355c240b7b1f52e18">read_bgp_prefix</a> (__u8 *ptr)</td></tr>
<tr class="memdesc:a3edfbd2b78d141f355c240b7b1f52e18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a BGP encoded prefix from an NLRI or withdraw message.  <a href="decode__helpers_8c.html#a3edfbd2b78d141f355c240b7b1f52e18">More...</a><br /></td></tr>
<tr class="separator:a3edfbd2b78d141f355c240b7b1f52e18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf62cf9fd7a378b8e7e6c5e11ef67975"><td class="memItemLeft" align="right" valign="top">__u8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="decode__helpers_8c.html#aaf62cf9fd7a378b8e7e6c5e11ef67975">get_var_int</a> (const u_char *data, __u64 *varint)</td></tr>
<tr class="memdesc:aaf62cf9fd7a378b8e7e6c5e11ef67975"><td class="mdescLeft">&#160;</td><td class="mdescRight">this function gets a variable encoded 64 bit integer from a 7 byte encoded string of bytes.  <a href="decode__helpers_8c.html#aaf62cf9fd7a378b8e7e6c5e11ef67975">More...</a><br /></td></tr>
<tr class="separator:aaf62cf9fd7a378b8e7e6c5e11ef67975"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a9df7d5bf99061b8754aad86196f71cde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9df7d5bf99061b8754aad86196f71cde">&#9670;&nbsp;</a></span>dump_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dump_buffer </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>dump_buffer takes a pointer and dumps a specific number of bytes </p>
<p>This function dumps memory in a format that is importable by wireshark or other programs that can import hex dumps </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer</td><td>A pointer to the memory to be dumped </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>The number of bytes to dump </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aaf62cf9fd7a378b8e7e6c5e11ef67975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf62cf9fd7a378b8e7e6c5e11ef67975">&#9670;&nbsp;</a></span>get_var_int()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u8 get_var_int </td>
          <td>(</td>
          <td class="paramtype">const u_char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u64 *&#160;</td>
          <td class="paramname"><em>varint</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>this function gets a variable encoded 64 bit integer from a 7 byte encoded string of bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>A pointer to the bytes we are extracting the variable integer from </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">varint</td><td>A pointer to where the extracted varint will be stored </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes used to encode the extracted varint </dd></dl>
<p>Zero out the varint before we start </p><div class="fragment"><div class="line">*varint = 0</div>
</div><!-- fragment --><p>If the first byte does not have the high order bit set take that as a standalone byte, else transverse the memory pointed to by data until either we have 10 bytes or until the high order bit is not set </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> ((data[0] &amp; 128) == 128) {</div>
<div class="line">  bytes[length] = data[data_count];</div>
<div class="line">  byte_count = 1;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <span class="keywordflow">while</span> ((data[data_count] &amp; 128) == 128) {</div>
<div class="line">      bytes[length--] = data[data_count++];</div>
<div class="line">      byte_count++;</div>
<div class="line">      <span class="keywordflow">if</span> (byte_count == 9)</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">  bytes[length] = data[data_count];</div>
<div class="line">}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="decode__helpers_8c_aaf62cf9fd7a378b8e7e6c5e11ef67975_cgraph.png" border="0" usemap="#adecode__helpers_8c_aaf62cf9fd7a378b8e7e6c5e11ef67975_cgraph" alt=""/></div>
<map name="adecode__helpers_8c_aaf62cf9fd7a378b8e7e6c5e11ef67975_cgraph" id="adecode__helpers_8c_aaf62cf9fd7a378b8e7e6c5e11ef67975_cgraph">
<area shape="rect" title="this function gets a variable encoded 64 bit integer from a 7 byte encoded string of bytes." alt="" coords="5,5,116,32"/>
<area shape="rect" href="decode__helpers_8c.html#a298daf8160cdf855a5ae27d4fb55b405" title="This function reverses a 10 byte array." alt="" coords="164,5,315,32"/>
</map>
</div>

</div>
</div>
<a id="a224ae6354763d1d7e15122ecbe5985e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a224ae6354763d1d7e15122ecbe5985e0">&#9670;&nbsp;</a></span>mem_to_msg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structproto__msg.html">proto_msg</a>* mem_to_msg </td>
          <td>(</td>
          <td class="paramtype">const __u8 *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is used to decode protobuf messages and message types. </p>
<p>This function reads a maximum of 10 bytes of memory into an array, terminating when one byte does not have its high order bit set. It then reverses the array, and concatenates the byte array into a single 64 bit integer, using only the low order 7 bits of each byte in the array. The result is then shifted right by 3 to produce the message code and AND'd by 7 to get the high order bytes to find the message type NOTE: It is important that this function returns allocated memory, and the result must be free'd by the calling function to avoid memory leaks. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>A pointer to the memory containing the bytes requiring decode </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An allocated <a class="el" href="structproto__msg.html">proto_msg</a> structure or NULL if allocation of memory fails </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="decode__helpers_8c_a224ae6354763d1d7e15122ecbe5985e0_cgraph.png" border="0" usemap="#adecode__helpers_8c_a224ae6354763d1d7e15122ecbe5985e0_cgraph" alt=""/></div>
<map name="adecode__helpers_8c_a224ae6354763d1d7e15122ecbe5985e0_cgraph" id="adecode__helpers_8c_a224ae6354763d1d7e15122ecbe5985e0_cgraph">
<area shape="rect" title="This function is used to decode protobuf messages and message types." alt="" coords="5,5,108,32"/>
<area shape="rect" href="decode__helpers_8c.html#a298daf8160cdf855a5ae27d4fb55b405" title="This function reverses a 10 byte array." alt="" coords="156,5,307,32"/>
</map>
</div>

</div>
</div>
<a id="a3edfbd2b78d141f355c240b7b1f52e18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3edfbd2b78d141f355c240b7b1f52e18">&#9670;&nbsp;</a></span>read_bgp_prefix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structbgp__ipv4__prefix.html">bgp_ipv4_prefix</a>* read_bgp_prefix </td>
          <td>(</td>
          <td class="paramtype">__u8 *&#160;</td>
          <td class="paramname"><em>ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a BGP encoded prefix from an NLRI or withdraw message. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="structbgp__ipv4__prefix.html">bgp_ipv4_prefix</a> @detail This function decodes compressed ipv4 prefix's as contained in bgp update messages. The first byte in the message represents the CIDR mask (The number of bits in the prefix). If the CIDR is fully divisible by 8, then CIDR/8 bytes are copied into the prefix element. If CIDR is NOT fully divisible by 8 then (CIDR/8)+1 bytes are copied into the prefix element. The next pointer element is set using the input pointer + 1 byte for the CIDR and then X bytes for the prefix itself, where X is either CIDR/8 or (CIDR/8)+1 NOTE: This function returns a pointer that must be free'd by the caller to avoid memory leaks. This function only serves for demonstration purposes because this type of processing would normally be done inline in a BGP update function without the need of additional memory allocation. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ptr</td><td>A Pointer to the start of the compressed prefix </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a298daf8160cdf855a5ae27d4fb55b405"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a298daf8160cdf855a5ae27d4fb55b405">&#9670;&nbsp;</a></span>reverse_array_10()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reverse_array_10 </td>
          <td>(</td>
          <td class="paramtype">__u8&#160;</td>
          <td class="paramname"><em>bytes</em>[]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reverses a 10 byte array. </p>
<p>This function is used primarily for handling variable integer decodes VARINT's are something used heavily in gbp file formats (Google protobuffers) NOTE: This function assumes that the input array is at least 10 bytes long and should the input array be less than 10 bytes this may cause unexpected behavior </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bytes</td><td>An array of bytes to be reversed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
